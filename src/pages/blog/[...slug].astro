---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'blog'>;
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const { title, description, pubDate, tags, author } = entry.data;

// Format the date
const formattedDate = pubDate.toLocaleDateString("en-US", { 
  year: 'numeric', 
  month: 'long', 
  day: 'numeric' 
});

// Future enhancement: add reading time calculation
---

<Layout title={title} description={description}>
  <article class="blog-post" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="blog-post-header">
      <nav aria-label="Breadcrumb" class="breadcrumb">
        <ol class="breadcrumb-list">
          <li><a href="/" class="breadcrumb-link">Home</a></li>
          <li><a href="/blog/" class="breadcrumb-link">Blog</a></li>
          <li class="breadcrumb-current" aria-current="page">{title}</li>
        </ol>
      </nav>
      
      <div class="blog-post-meta">
        <h1 class="blog-post-title" itemprop="headline">{title}</h1>
        
        <div class="blog-post-byline">
          <div class="blog-post-date">
            <span class="sr-only">Published on</span>
            <time datetime={pubDate.toISOString()} itemprop="datePublished">
              {formattedDate}
            </time>
          </div>
          
          {author && (
            <div class="blog-post-author" itemprop="author">
              <span class="sr-only">By</span>
              <span>{author}</span>
            </div>
          )}
        </div>
        
        {tags && tags.length > 0 && (
          <div class="blog-post-tags">
            <span class="sr-only">Tagged with:</span>
            {tags.map((tag) => (
              <span class="blog-post-tag" itemprop="keywords">{tag}</span>
            ))}
          </div>
        )}
      </div>
    </header>

    <div class="blog-post-content prose" itemprop="articleBody">
      <Content />
    </div>

    <footer class="blog-post-footer">
      <nav aria-label="Post navigation" class="post-navigation">
        <a href="/blog/" class="btn btn-secondary">
          ← Back to all posts
        </a>
      </nav>
    </footer>
  </article>
</Layout>

<style>
  .blog-post {
    max-width: none;
  }
  
  .blog-post-header {
    margin-bottom: var(--space-12);
  }
  
  /* Breadcrumb */
  .breadcrumb {
    margin-bottom: var(--space-8);
  }
  
  .breadcrumb-list {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    list-style: none;
    padding: 0;
    margin: 0;
    font-size: var(--font-size-sm);
    color: var(--color-muted-foreground);
  }
  
  .breadcrumb-list li:not(:last-child)::after {
    content: "→";
    margin-left: var(--space-2);
    color: var(--color-muted-foreground);
  }
  
  .breadcrumb-link {
    color: var(--color-muted-foreground);
    text-decoration: none;
    transition: color var(--transition-fast);
  }
  
  .breadcrumb-link:hover {
    color: var(--color-link);
    text-decoration: underline;
  }
  
  .breadcrumb-current {
    font-weight: 500;
  }
  
  /* Post Meta */
  .blog-post-meta {
    text-align: center;
    max-width: 42rem;
    margin: 0 auto;
  }
  
  .blog-post-title {
    font-size: var(--font-size-4xl);
    font-weight: 700;
    line-height: var(--line-height-tight);
    color: var(--color-foreground);
    margin: 0 0 var(--space-6) 0;
  }
  
  @media (min-width: 768px) {
    .blog-post-title {
      font-size: var(--font-size-5xl);
    }
  }
  
  .blog-post-byline {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--space-4);
    margin-bottom: var(--space-6);
    font-size: var(--font-size-sm);
    color: var(--color-muted-foreground);
  }
  
  .blog-post-date {
    font-weight: 500;
  }
  
  .blog-post-author {
    font-weight: 500;
  }
  
  .blog-post-author::before {
    content: "•";
    margin-right: var(--space-2);
  }
  
  /* Tags */
  .blog-post-tags {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: var(--space-2);
  }
  
  .blog-post-tag {
    display: inline-block;
    padding: var(--space-1) var(--space-3);
    background: var(--color-muted);
    color: var(--color-muted-foreground);
    font-size: var(--font-size-xs);
    font-weight: 500;
    border-radius: var(--radius-full);
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }
  
  /* Content */
  .blog-post-content {
    max-width: var(--content-max-width);
    margin: 0 auto var(--space-12);
  }
  
  .blog-post-content :global(h2) {
    margin-top: var(--space-12);
    margin-bottom: var(--space-4);
    padding-top: var(--space-4);
    border-top: 1px solid var(--color-border-subtle);
  }
  
  .blog-post-content :global(h2:first-child) {
    border-top: none;
    padding-top: 0;
    margin-top: var(--space-8);
  }
  
  .blog-post-content :global(h3) {
    margin-top: var(--space-8);
    margin-bottom: var(--space-4);
  }
  
  .blog-post-content :global(p) {
    margin-bottom: var(--space-4);
    line-height: var(--line-height-relaxed);
  }
  
  .blog-post-content :global(blockquote) {
    margin: var(--space-8) 0;
    padding: var(--space-4) var(--space-6);
    background: var(--color-muted);
    border-left: 4px solid var(--color-primary-500);
    border-radius: var(--radius-md);
    font-style: italic;
  }
  
  .blog-post-content :global(code) {
    font-family: var(--font-family-mono);
    font-size: 0.875em;
    background: var(--color-muted);
    padding: 0.125rem 0.25rem;
    border-radius: var(--radius-sm);
    color: var(--color-foreground);
  }
  
  .blog-post-content :global(pre) {
    font-family: var(--font-family-mono);
    font-size: var(--font-size-sm);
    line-height: var(--line-height-relaxed);
    background: var(--color-muted);
    padding: var(--space-4);
    border-radius: var(--radius-lg);
    overflow-x: auto;
    margin: var(--space-6) 0;
    border: 1px solid var(--color-border);
  }
  
  .blog-post-content :global(pre code) {
    background: none;
    padding: 0;
    border-radius: 0;
    font-size: inherit;
  }
  
  /* Footer */
  .blog-post-footer {
    border-top: 1px solid var(--color-border);
    padding-top: var(--space-8);
    text-align: center;
  }
  
  .post-navigation {
    display: flex;
    justify-content: center;
  }
</style>
